# PixSTD.DataUtilities
**–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ—Ç PixSTD**

üì¶ NuGet: `PixSTD.DataUtilities`  
üë®üíª –ê–≤—Ç–æ—Ä: PixSTD  
üêô –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: https://github.com/PixSTD/DataUtilities.dll  
üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è: MIT

**PixSTD.DataUtilities** ‚Äî –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è .NET, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è:

- **üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- **üóÇÔ∏è –•—Ä–∞–Ω–µ–Ω–∏–µ** ‚Äî –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ —Å —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø—É—Ç–µ–π  
- **üì° –°–µ—Ç–µ–≤–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞** ‚Äî —É–ø–∞–∫–æ–≤–∫–∞/—Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ—Ç–µ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏
- **üì¶ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –±—ã—Å—Ç—Ä–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ MessagePack
- **‚ö° –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** ‚Äî .NET Standard 2.1, 8, 9, 10
- **üåê –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** ‚Äî Windows, Linux, Android
- **üìù –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å** ‚Äî –ø–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

## üìë –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [üìñ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è](#-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
  - [üîß –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã](#-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã)
  - [‚öôÔ∏è –ú–µ—Ç–æ–¥—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏](#-–º–µ—Ç–æ–¥—ã-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏-–º–æ–∂–Ω–æ-–≤—ã–∑—ã–≤–∞—Ç—å-–ø–æ—Å–ª–µ-—Å–æ–∑–¥–∞–Ω–∏—è)
  - [üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#-–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
  - [‚ùó –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è](#-–≤–∞–∂–Ω—ã–µ-–∑–∞–º–µ—á–∞–Ω–∏—è)
- [üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö](#-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ-–∏-–∑–∞–≥—Ä—É–∑–∫–∞-–¥–∞–Ω–Ω—ã—Ö)
  - [üì§ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤](#-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ-–æ–±—ä–µ–∫—Ç–æ–≤)
  - [üì• –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤](#-–∑–∞–≥—Ä—É–∑–∫–∞-–æ–±—ä–µ–∫—Ç–æ–≤)
  - [üîÑ –†–∞–±–æ—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö](#-—Ä–∞–±–æ—Ç–∞-—Å-—Ä–∞–∑–Ω—ã–º–∏-—Ç–∏–ø–∞–º–∏-–¥–∞–Ω–Ω—ã—Ö)
  - [üéØ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#-–ø—Ä–∏–º–µ—Ä-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [üìÅ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫](#-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ-—Ñ–∞–π–ª–æ–≤-–∏-–ø–∞–ø–æ–∫)
  - [üìÑ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤](#-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ-—Ñ–∞–π–ª–æ–≤)
  - [üìÇ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–æ–∫ (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ)](#-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ-–ø–∞–ø–æ–∫-—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ)
  - [üéØ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#-–ø—Ä–∏–º–µ—Ä-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è-1)
  - [üîç –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫](#-–ø–æ–∏—Å–∫-—Ñ–∞–π–ª–æ–≤-–∏-–ø–∞–ø–æ–∫)
  - [üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫](#-—É–¥–∞–ª–µ–Ω–∏–µ-—Ñ–∞–π–ª–æ–≤-–∏-–ø–∞–ø–æ–∫)
- [üõ†Ô∏è –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏](#-–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ-—Ñ—É–Ω–∫—Ü–∏–∏)
  - [üìÇ –†–∞–±–æ—Ç–∞ —Å –ø—É—Ç—è–º–∏](#-—Ä–∞–±–æ—Ç–∞-—Å-–ø—É—Ç—è–º–∏)
  - [üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤](#-–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è-–æ–±—ä–µ–∫—Ç–æ–≤)
- [üîê –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–±–æ—Ç–∞ —Å —Å–µ—Ç—å—é](#-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ-–∏-—Ä–∞–±–æ—Ç–∞-—Å-—Å–µ—Ç—å—é)
  - [üîí –õ–æ–∫–∞–ª—å–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ](#-–ª–æ–∫–∞–ª—å–Ω–æ–µ-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ)
  - [üåê –°–µ—Ç–µ–≤–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ](#-—Å–µ—Ç–µ–≤–æ–µ-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ)
- [üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π](#-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏-–æ–±—Ä–∞–±–æ—Ç–∫–∞-—Å–æ–±—ã—Ç–∏–π)
  - [üéØ –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è](#-—Å–∏—Å—Ç–µ–º–∞-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
  - [üîî –°–æ–±—ã—Ç–∏–µ Log](#-—Å–æ–±—ã—Ç–∏–µ-log)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```csharp
	using DataUtilities;
	using System;
	using System.IO;
	using System.Threading.Tasks;

	// 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
	
	string localAppData = Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData);
	string appFolder = Path.Combine(localAppData, "CompanyName", "YourAppName");
	
	var data = new PlayerData(
		hash: "–≤–∞—à_–∫–ª—é—á_—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è",			// byte[] –∏–ª–∏ string
		startPath: appFolder,					// –∫—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–∞–π–ª—ã
		lengthNameDirectory: HexLength.Short, 	// 8 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –ø–∞–ø–∫–∏
		lengthNameFile: HexLength.Short,       	// 8 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è —Ñ–∞–π–ª–∞ (–ü—Ä–∏–º–µ—Ä: "player/profile" ‚Üí "a1b2c3d4/e5f67890")
		offsetHashHex: -1						// –°–º–µ—â–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —Ö—ç—à–∞. –ó–Ω–∞—á–µ–Ω–∏–µ -1 –æ–∑–Ω–∞—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–¥–≤–∏–≥, —Ä–∞–≤–Ω—ã–π –¥–ª–∏–Ω–µ —Ö—ç—à–∏—Ä—É–µ–º–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
	);
	
	
	// 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
	
	await data.SaveA(profile, "data/player/profile");
	// ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ —Å —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—É—Ç—è–º–∏
	
	// 3. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
	
	ProfileType profile;  // –≤–∞—à —Ç–∏–ø –∫–ª–∞—Å—Å–∞ –ø—Ä–æ—Ñ–∏–ª—è
	bool loaded = await data.LoadA<ProfileType>(out profile, "data/player/profile");
	
	if (loaded)
		Console.WriteLine("–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!");
	else
		Console.WriteLine("–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω");
	
	
	// 4. –û—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ —Å–µ—Ç–∏
	
	byte[] networkData = data.EncryptNetworkData(request);  // ‚Üí –≥–æ—Ç–æ–≤–æ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ
	
	// –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è:
	MemoryStream receivedStream = new MemoryStream();  // —Å—é–¥–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç –ø–∞–∫–µ—Ç—ã
	
	// –ö–æ–≥–¥–∞ –ø–æ–ª—É—á–∏–ª–∏ –∫—É—Å–æ–∫ –¥–∞–Ω–Ω—ã—Ö:
	byte[] chunk = ...;  // –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∫—É—Å–æ–∫
	receivedStream.Write(chunk, 0, chunk.Length);
	
	// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å—ë, —á—Ç–æ –Ω–∞–∫–æ–ø–∏–ª–æ—Å—å
	var remains = data.DecryptNetworkData<Request>(
		receivedStream.ToArray(),
		req =>
		{
			// –ó–¥–µ—Å—å –≤–∞—à–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
			Console.WriteLine($"–ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å: {req.Key}");
		});
	
	// remains ‚Äî —ç—Ç–æ –Ω–µ–ø–æ–ª–Ω—ã–π –∫—É—Å–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –µ—â—ë –Ω–µ –æ–±—Ä–∞–∑–æ–≤–∞–ª —Ü–µ–ª–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
	receivedStream.SetLength(0);  // –æ—á–∏—â–∞–µ–º –ø–æ—Ç–æ–∫
	
	if (remains.Length > 0)
	{
		receivedStream.Write(remains.ToArray(), 0, remains.Length);
		// —Ç–µ–ø–µ—Ä—å –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –ø–∞–∫–µ—Ç–µ –æ—Å—Ç–∞—Ç–æ–∫ –±—É–¥–µ—Ç —É—á—Ç—ë–Ω
	}
	
	
	// 5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
	
	data.Log += (logEvent) =>
	{
		if (logEvent.Level <= DataLogLevel.Info)
			Console.WriteLine(logEvent.Message);
	};
```

## üìñ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

### üîß –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã

#### `PlayerData(string hash, ...)`
–°–æ–∑–¥–∞—ë—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä —Å —Å—Ç—Ä–æ–∫–æ–≤—ã–º –∫–ª—é—á–æ–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è.

```csharp
// –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç
var storage = new PlayerData("–º–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á");

// –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
var storage = new PlayerData(
    hash: "–º–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á",
    startPath: "C:/MyApp/Data",           // –ö—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–∞–π–ª—ã
    lengthNameDirectory: HexLength.Medium, // –î–ª–∏–Ω–∞ —Ö—ç—à–∞ –¥–ª—è –ø–∞–ø–æ–∫ (16 —Å–∏–º–≤–æ–ª–æ–≤)
    lengthNameFile: HexLength.Short,      // –î–ª–∏–Ω–∞ —Ö—ç—à–∞ –¥–ª—è —Ñ–∞–π–ª–æ–≤ (8 —Å–∏–º–≤–æ–ª–æ–≤)
    offsetHashHex: -1                     // –ê–≤—Ç–æ—Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ö—ç—à–µ–π
);
```

#### `PlayerData(byte[] hash, ...)`
–¢–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ —Å –±–∞–π—Ç–æ–≤—ã–º –∫–ª—é—á–æ–º (–±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ).

```csharp
// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –∏–∑ –±–∞–π—Ç–æ–≤
var keyBytes = Encoding.UTF8.GetBytes("–º–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á");
var storage = new PlayerData(keyBytes);
```

### ‚öôÔ∏è –ú–µ—Ç–æ–¥—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è)

#### `SetHash(string hash)` / `SetHash(byte[] hash)`
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏–ª–∏ –∏–∑–º–µ–Ω—è–µ—Ç –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è.

```csharp
var storage = new PlayerData("–º–æ–π-–≤—Ä–µ–º–µ–Ω–Ω—ã–π-–∫–ª—é—á");

// –ü–æ–∑–∂–µ –º–µ–Ω—è–µ–º –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
storage.SetHash("–º–æ–π-–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π-–∫–ª—é—á");

// –ë–∞–π—Ç–æ–≤—ã–π –∫–ª—é—á (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
var secureHash = new byte[] { 0x01, 0x02, 0x03, ... };
storage.SetHash(secureHash);
```

> **‚ö†Ô∏è –í–∞–∂–Ω–æ:** –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–ª—é—á–∞ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã!

#### `SetStartPath(string path)`
–ó–∞–¥–∞—ë—Ç –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

```csharp
// –î–ª—è desktop-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
storage.SetStartPath(Path.Combine(
    Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
    "CompanyName",
	"YourAppName"
));

// –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (Xamarin/MAUI)
storage.SetStartPath(FileSystem.AppDataDirectory);

// –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø—É—Ç—å –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```

#### `SetLengthNameDirectory(HexLength length)`  

#### `SetLengthNameFile(HexLength length)`
–ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç –¥–ª–∏–Ω—É —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–º—ë–Ω.

```csharp
// –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è HexLength:
//Short  - 8 —Å–∏–º–≤–æ–ª–æ–≤  (4 –±–∞–π—Ç–∞)
//Medium - 16 —Å–∏–º–≤–æ–ª–æ–≤ (8 –±–∞–π—Ç)
//Long   - 32 —Å–∏–º–≤–æ–ª–∞  (16 –±–∞–π—Ç)
//Full 	 - 64 —Å–∏–º–≤–æ–ª–∞  (32 –±–∞–π—Ç–∞) - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

// –ü—Ä–∏–º–µ—Ä: –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
storage.SetLengthNameDirectory(HexLength.Medium);
storage.SetLengthNameFile(HexLength.Medium);
// –ü—É—Ç—å "users/profile" ‚Üí "a1b2e5f67890c3d4/e5f6a1b2c3d47890"
```

#### `SetOffsetHashHex(int offsetHex)`
–°–º–µ—â–µ–Ω–∏–µ –≤ —Ö—ç—à–µ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∫–æ–ª–ª–∏–∑–∏–π.

```csharp
// –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ
storage.SetOffsetHashHex(10); // –ù–∞—á–∏–Ω–∞—Ç—å —Ö—ç—à —Å 10-–≥–æ —Å–∏–º–≤–æ–ª–∞

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–º–µ—â–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
storage.SetOffsetHashHex(-1); // –°–º–µ—â–µ–Ω–∏–µ = –¥–ª–∏–Ω–∞ —Ö—ç—à–∏—Ä—É–µ–º–æ–π —Å—Ç—Ä–æ–∫–∏

// –ü—Ä–∏–º–µ—Ä —Å offsetHashHex = -1:
// "users" (5 —Å–∏–º–≤–æ–ª–æ–≤) ‚Üí —Ö—ç—à –Ω–∞—á–∏–Ω–∞—è —Å 5-–π –ø–æ–∑–∏—Ü–∏–∏
// "profile" (7 —Å–∏–º–≤–æ–ª–æ–≤) ‚Üí —Ö—ç—à –Ω–∞—á–∏–Ω–∞—è —Å 7-–π –ø–æ–∑–∏—Ü–∏–∏
```

### üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–µ desktop-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```csharp
public class AppStorage
{
    private readonly PlayerData storage;
    
    public AppStorage()
    {
        storage = new PlayerData(
            hash: "–º–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á",
            startPath: Path.Combine(
                Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
                "PixSTD",
                "MyApp"
            ),
            lengthNameDirectory: HexLength.Medium,
            lengthNameFile: HexLength.Medium,
            offsetHashHex: -1
        );
    }
}
```

#### –ü—Ä–∏–º–µ—Ä 2: –ü–æ—ç—Ç–∞–ø–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```csharp
// –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –≥–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
var storage = new PlayerData("–º–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á");

// –ü–æ–∑–∂–µ, –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
storage.SetHash("–º–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á");
storage.SetStartPath(GetUserDataPath());
storage.SetLengthNameDirectory(HexLength.Medium);
storage.SetLengthNameFile(HexLength.Medium);
storage.SetOffsetHashHex(-1);
```

### ‚ùó –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è**:
   - –ë–∞–π—Ç–æ–≤—ã–π –∫–ª—é—á: –ú–∏–Ω–∏–º—É–º 16 –±–∞–π—Ç
   - –•—Ä–∞–Ω–∏—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ (–Ω–µ –≤ –∫–æ–¥–µ!)
   - –ü—Ä–∏ —É—Ç–µ—Ä–µ –∫–ª—é—á–∞ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å

2. **–ü—É—Ç–∏**:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–∞–ø–∫–∏
   - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
   - –†–∞–∑–Ω—ã–µ –¥–ª–∏–Ω—ã —Ö—ç—à–µ–π –¥–ª—è –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤ —É—Å–ª–æ–∂–Ω—è—é—Ç –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
   - –°–º–µ—â–µ–Ω–∏–µ (`offsetHashHex`) –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç pattern analysis

## üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### üì§ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤

#### `Save(object data, string encryptedPath, string unencryptedPath = "")`
–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

#### `SaveA(object data, string encryptedPath, string unencryptedPath = "")`
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è).

```csharp
// –õ—é–±–æ–π –æ–±—ä–µ–∫—Ç –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
var user = new { Name = "–ò–≤–∞–Ω", Age = 25, Email = "ivan@mail.com" };
var settings = new AppSettings { Theme = "Dark", Language = "RU" };

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ
storage.Save(user, "users/ivan/profile");
await storage.SaveA(settings, "app/settings");

// –° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–∞–ø–∫—É
await storage.SaveA(
    data: user,
    encryptedPath: "profile",           // —Ö—ç—à–∏—Ä—É–µ—Ç—Å—è: "profile" ‚Üí "e5f6a1b2c3d47890"
    unencryptedPath: "C:/backups/users" // –ù–µ —Ö—ç—à–∏—Ä—É–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å
);
```

### üì• –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤

#### `Load<T>(Action<T> apply, string encryptedPath, string unencryptedPath = "")`
–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —á–µ—Ä–µ–∑ callback.

#### `LoadA<T>(Action<T> apply, string encryptedPath, string unencryptedPath = "")`
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞.

#### `Load<T>(out T value, string encryptedPath, string unencryptedPath = "")`
–ó–∞–≥—Ä—É–∑–∫–∞ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º –∑–Ω–∞—á–µ–Ω–∏—è.

```csharp
// –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ callback (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏)
storage.Load<AppSettings>(settings => 
{
    Console.WriteLine($"–¢–µ–º–∞: {settings.Theme}");
    ApplyTheme(settings.Theme);
}, "app/settings");

// –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
await storage.LoadA<List<Document>>(documents =>
{
    foreach (var doc in documents)
        ProcessDocument(doc);
}, "projects/report/documents");

// –°–ø–æ—Å–æ–± 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é
if (storage.Load<User>(out var user, "users/ivan/profile"))
{
    Console.WriteLine($"–ü—Ä–∏–≤–µ—Ç, {user.Name}!");
}
else
{
    Console.WriteLine("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–∞–ø–∫–∏
storage.Load<BackupData>(
    data => RestoreBackup(data),
    encryptedPath: "backup",
    unencryptedPath: "D:/archives"
);
```

### üîÑ –†–∞–±–æ—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

```csharp
// –ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ —Ç–∏–ø—ã
await storage.SaveA(42, "config/max_items");
await storage.SaveA("Hello World", "messages/greeting");

// –ö–æ–ª–ª–µ–∫—Ü–∏–∏
var scores = new Dictionary<string, int> 
{ 
    ["–ò–≤–∞–Ω"] = 100, 
    ["–ú–∞—Ä–∏—è"] = 95 
};
await storage.SaveA(scores, "game/scores");

// –°–ª–æ–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
[MessagePackObject] // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ MessagePack —É–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –Ω–∞ 20-30%
public class Invoice
{
    [Key(0)]
    public string Number { get; set; }
    [Key(1)]
    public DateTime Date { get; set; }
    [Key(2)]
    public List<InvoiceItem> Items { get; set; }
    [Key(3)]
    public decimal Total { get; set; }
}

var invoice = new Invoice { /* ... */ };
await storage.SaveA(invoice, $"invoices/{invoice.Number}");
```

### üéØ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```csharp
public class UserService
{
    private readonly PlayerData storage;
    
    public async Task<User> GetUserAsync(string userId)
    {
        if (storage.Load<User>(out var user, $"users/{userId}/profile"))
            return user;
            
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç - —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–≥–æ
        var newUser = new User { Id = userId, Created = DateTime.Now };
        await storage.SaveA(newUser, $"users/{userId}/profile");
        return newUser;
    }
    
    public async Task SaveUserSettingsAsync(string userId, UserSettings settings)
    {
        await storage.SaveA(settings, $"users/{userId}/settings");
    }
    
    public async Task<List<User>> GetAllUsersAsync()
    {
        var users = new List<User>();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ø–∞–ø–∫–∏ users/
        var userFolders = storage.GetDirectories("users");
        foreach (var folder in userFolders)
        {
            if (storage.Load<User>(out var user, "profile", folder))
                users.Add(user);
        }
        
        return users;
    }
}
```

## üìÅ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫

### üìÑ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

#### `CopyFile(string fromEncryptedPath, string toEncryptedPath, ...)`
–ö–æ–ø–∏—Ä—É–µ—Ç –æ–¥–∏–Ω —Ñ–∞–π–ª –≤ –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ.

```csharp
// –ë–∞–∑–æ–≤–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª)
storage.CopyFile(
    fromEncryptedPath: "users/ivan/profile",
    toEncryptedPath: "backups/users/ivan_profile_backup"
);

// –° —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–∞–ø–æ–∫
storage.CopyFile(
    fromEncryptedPath: "report",
	toEncryptedPath: "archive/report_2026",
    fromUnencryptedPath: "C:/reports/2026",	// –ò—Å—Ö–æ–¥–Ω–∞—è –ø–∞–ø–∫–∞
    toUnencryptedPath: "D:/archive",       	// –ö–æ–Ω–µ—á–Ω–∞—è –ø–∞–ø–∫–∞
    overwrite: true                        	// –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
);

// –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç)
storage.CopyFile(
    fromEncryptedPath: "config/settings",
    toEncryptedPath: "config/settings_backup",
    overwrite: false  // –ï—Å–ª–∏ —Ñ–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è
);
```

### üìÇ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–æ–∫ (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ)

#### `CopyDirectory(string fromEncryptedPath, string toEncryptedPath, ...)`
–ö–æ–ø–∏—Ä—É–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ –æ–¥–Ω–æ–π –ø–∞–ø–∫–∏ –≤ –¥—Ä—É–≥—É—é.

```csharp
// –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–π –ø–∞–ø–∫–∏
var (copied, total) = storage.CopyDirectory(
    fromEncryptedPath: "users",
    toEncryptedPath: "backups/2026/users"
);

Console.WriteLine($"–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: {copied}/{total} —Ñ–∞–π–ª–æ–≤");

// –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é
storage.CopyDirectory(
    fromEncryptedPath: "app/logs",
    toEncryptedPath: "archive/logs_january",
    overwrite: true  // –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã
);

// –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∫–æ—Ä–Ω–µ–≤—ã–º–∏ –ø–∞–ø–∫–∞–º–∏
storage.CopyDirectory(
    fromEncryptedPath: "data/project_x",
	toEncryptedPath: "backups/project_x",
    fromUnencryptedPath: "C:/projects/current",
    toUnencryptedPath: "D:/backups/archive"
);
```

### üéØ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```csharp
public class BackupService
{
    private readonly PlayerData storage;
    
    public void CreateUserBackup(string userId, string backupName)
    {
        var backupPath = $"backups/{DateTime.Now:yyyy-MM-dd}/{userId}";
        
        // –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±—ç–∫–∞–ø
        storage.CopyDirectory(
            fromEncryptedPath: $"users/{userId}",
            toEncryptedPath: $"{backupPath}"
        );
        
        // –ö–æ–ø–∏—Ä—É–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ –≤–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
        var importantFiles = new[]
        {
            $"users/{userId}/profile",
            $"users/{userId}/settings",
            $"users/{userId}/subscription"
        };
        
        foreach (var file in importantFiles)
        {
			var fileName = PlayerData.GetNameFile(file);
			storage.CopyFile(
				fromEncryptedPath: file,
				toEncryptedPath: $"{backupPath}/critical/{fileName}"
			);
        }
    }
    
    public void RestoreUserBackup(string userId, string backupDate)
    {
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ –±—ç–∫–∞–ø–∞
        storage.CopyDirectory(
            fromEncryptedPath: $"backups/{backupDate}/{userId}",
            toEncryptedPath: $"users/{userId}",
            overwrite: true  // –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
        );
    }
}
```

### üîç –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫

#### `SearchFile(string encryptedPath, ...)` / `SearchDirectory(...)`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–∞–ø–∫–∏.

```csharp
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
if (storage.SearchFile("users/ivan/profile"))
{
    Console.WriteLine("–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç");
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–∞–ø–∫–∏
if (storage.SearchDirectory("users"))
{
    var userCount = storage.QuantityDirectories("users");
    Console.WriteLine($"–ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {userCount}");
}

// –ü–æ–∏—Å–∫ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–∞–ø–∫–∏
var exists = storage.SearchFile(
    encryptedPath: "report",
    unencryptedPath: "C:/documents/reports"
);
```

#### `GetFiles(string encryptedPath, ...)` / `GetDirectories(...)`
–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ –ø–∞–ø–æ–∫.

```csharp
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ
var allFiles = storage.GetFiles("users/ivan");
foreach (var file in allFiles)
{
    Console.WriteLine($"–§–∞–π–ª: {file}");
}

// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–æ–¥–ø–∞–ø–∫–∏
var userFolders = storage.GetDirectories("users");
foreach (var folder in userFolders)
{
    var userName = PlayerData.GetNameDirectory(folder);
    Console.WriteLine($"–ü–∞–ø–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {userName}");
}

// –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
var imageFiles = storage.GetFiles("gallery")
    .Where(f => f.EndsWith(".jpg") || f.EndsWith(".png"));
```

#### `QuantityFiles(...)` / `QuantityDirectories(...)`
–ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ –ø–∞–ø–æ–∫.

```csharp
// –ü–æ–¥—Å—á—ë—Ç —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ
var fileCount = storage.QuantityFiles("projects/report");
var folderCount = storage.QuantityDirectories("projects");

Console.WriteLine($"–ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç: {fileCount} —Ñ–∞–π–ª–æ–≤ –≤ {folderCount} –ø–∞–ø–∫–∞—Ö");

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
public StorageInfo GetStorageInfo()
{
    return new StorageInfo
    {
        TotalFiles = storage.QuantityFiles(""),
        TotalDirectories = storage.QuantityDirectories(""),
        UserFiles = storage.QuantityFiles("users"),
        BackupFiles = storage.QuantityFiles("backups")
    };
}
```

### üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫

#### `DeleteFile(string encryptedPath, ...)` / `DeleteDirectory(...)`
–£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏ (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ).

```csharp
// –£–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
storage.DeleteFile("temp/cache_data");

// –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞–ø–∫–∏ —Å–æ –≤—Å–µ–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º
storage.DeleteDirectory("old_backups");

// –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
public void CleanupTempFiles()
{
    var tempFiles = storage.GetFiles("temp");
    foreach (var file in tempFiles)
    {
        // –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã
        if (IsFileOlderThan(file, TimeSpan.FromDays(7)))
        {
            storage.DeleteFile("", file);
        }
    }
}
```

## üõ†Ô∏è –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### üìÇ –†–∞–±–æ—Ç–∞ —Å –ø—É—Ç—è–º–∏

#### `NormalizePath(string path)`
–ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –ø—É—Ç—å, –∑–∞–º–µ–Ω—è—è –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–ª–µ—à–∏ –∏ —É–±–∏—Ä–∞—è –¥–≤–æ–π–Ω—ã–µ —Å–ª–µ—à–∏.

```csharp
// –ü—Ä–∏–º–µ—Ä—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
var path1 = PlayerData.NormalizePath("C:\\Users\\ivan\\data");
// ‚Üí "C:/Users/ivan/data"

var path2 = PlayerData.NormalizePath("folder//subfolder\\\\file.txt");
// ‚Üí "folder/subfolder/file.txt"

var path3 = PlayerData.NormalizePath(@"app\data\");
// ‚Üí "app/data/"
```

#### `GetNameFile(string path)`
–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–º—è —Ñ–∞–π–ª–∞ –∏–∑ –ø—É—Ç–∏.

```csharp
// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
var fileName = PlayerData.GetNameFile("users/ivan/profile.dat");
// ‚Üí "profile.dat"

var fileName2 = PlayerData.GetNameFile("C:/projects/report.pdf");
// ‚Üí "report.pdf"

var fileName3 = PlayerData.GetNameFile("folder/subfolder/");
// ‚Üí "" (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–∞–ø–æ–∫)
```

#### `GetNameDirectory(string path)`
–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–∞–ø–∫–∏ –∏–∑ –ø—É—Ç–∏.

```csharp
// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–∞–ø–∫–∏
var dirName = PlayerData.GetNameDirectory("users/ivan/profile.dat");
// ‚Üí "ivan"

var dirName2 = PlayerData.GetNameDirectory("projects/2024/january/");
// ‚Üí "january"

var dirName3 = PlayerData.GetNameDirectory("file.txt");
// ‚Üí "" (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ—Ä–Ω–µ)
```

#### `GetPathToDirectory(string path)`
–ü–æ–ª—É—á–∞–µ—Ç –ø—É—Ç—å –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –ø–∞–ø–∫–µ.

```csharp
// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –ø–∞–ø–∫–µ
var parentPath = PlayerData.GetPathToDirectory("users/ivan/profile.dat");
// ‚Üí "users/ivan/"

var parentPath2 = PlayerData.GetPathToDirectory("projects/");
// ‚Üí "projects/"

var parentPath3 = PlayerData.GetPathToDirectory("file.txt");
// ‚Üí "" (–∫–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞)
```

#### `GetCutPath(string path, int keepRight = 1)`
–û—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –ø—É—Ç–∏ —Å–ø—Ä–∞–≤–∞.

```csharp
// –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –ø—É—Ç–∏
var shortPath = PlayerData.GetCutPath("projects/2024/january/report.pdf", 2);
// ‚Üí "january/report.pdf"

var shortPath2 = PlayerData.GetCutPath("users/ivan/documents/contract.pdf", 1);
// ‚Üí "contract.pdf"

var shortPath3 = PlayerData.GetCutPath("folder1/folder2/folder3/", 3);
// ‚Üí "folder1/folder2/folder3/"
```

### üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤

#### `Convert(object data)` ‚Üí `byte[]`
–°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –ª—é–±–æ–π –æ–±—ä–µ–∫—Ç –≤ –±–∞–π—Ç—ã —Å –ø–æ–º–æ—â—å—é MessagePack.

```csharp
// –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
var user = new { Name = "–ò–≤–∞–Ω", Age = 30 };
byte[] userBytes = PlayerData.Convert(user);

var settings = new AppSettings { Theme = "Dark" };
byte[] settingsBytes = PlayerData.Convert(settings);

// –†–∞–±–æ—Ç–∞ —Å –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏
var numbers = new List<int> { 1, 2, 3, 4, 5 };
byte[] numbersBytes = PlayerData.Convert(numbers);

// –°–ª–æ–≤–∞—Ä–∏ —Ç–æ–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
var dict = new Dictionary<string, string>
{
    ["key1"] = "value1",
    ["key2"] = "value2"
};
byte[] dictBytes = PlayerData.Convert(dict);

// –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ MessagePack
[MessagePackObject]
public class OptimizedData
{
    [Key(0)] public int Id { get; set; }
    [Key(1)] public string Name { get; set; }
    [Key(2)] public DateTime Created { get; set; }
}

var optimized = new OptimizedData { Id = 1, Name = "Test" };
byte[] optimizedBytes = PlayerData.Convert(optimized); // –ë–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
```

#### `Convert<T>(byte[] data)` ‚Üí `T`
–î–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –±–∞–π—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ–±—ä–µ–∫—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞.

```csharp
// –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
byte[] userData = // ... –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –±–∞–π—Ç—ã
var user = PlayerData.Convert<User>(userData);

// –†–∞–±–æ—Ç–∞ —Å –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏
byte[] listData = // ... –±–∞–π—Ç—ã —Å–ø–∏—Å–∫–∞
var numbers = PlayerData.Convert<List<int>>(listData);
```

#### `Convert(byte[] data, Type type)` ‚Üí `object`
–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É.

```csharp
// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
Type targetType = typeof(UserProfile);
byte[] data = // ... –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –±–∞–π—Ç—ã

object result = PlayerData.Convert(data, targetType);
if (result is UserProfile profile)
{
    Console.WriteLine($"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {profile.Name}");
}
```

## üîê –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–±–æ—Ç–∞ —Å —Å–µ—Ç—å—é

### üîí –õ–æ–∫–∞–ª—å–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

#### `Encrypt(byte[] plaintext)` ‚Üí `byte[]`
–®–∏—Ñ—Ä—É–µ—Ç –º–∞—Å—Å–∏–≤ –±–∞–π—Ç–æ–≤

```csharp
// –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
var user = new { Name = "–ò–≤–∞–Ω", Password = "secret123" };
byte[] serialized = PlayerData.Convert(user);
byte[] encryptedUser = storage.Encrypt(serialized);
```

#### `Decrypt(byte[] data)` ‚Üí `byte[]`
–†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –º–∞—Å—Å–∏–≤ –±–∞–π—Ç–æ–≤, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥–æ–º `Encrypt`.

```csharp
// –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
byte[] encryptedUserData = // ... –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
byte[] decryptedData = storage.Decrypt(encryptedUserData);
var user = PlayerData.Convert<User>(decryptedData);
```

### üåê –°–µ—Ç–µ–≤–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

#### `EncryptNetworkData(object data)` ‚Üí `byte[]`
–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç –¥–ª—è —Å–µ—Ç–µ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏: —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç, —à–∏—Ñ—Ä—É–µ—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –º–∞—Ä–∫–µ—Ä—ã.

```csharp
// –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ —Å–µ—Ç–∏
var message = new ChatMessage
{
    Sender = "–ò–≤–∞–Ω",
    Text = "–ü—Ä–∏–≤–µ—Ç!",
    Timestamp = DateTime.UtcNow
};

byte[] networkPacket = storage.EncryptNetworkData(message);
// ‚Üí –º–∞—Ä–∫–µ—Ä_–Ω–∞—á–∞–ª–æ + –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ + –º–∞—Ä–∫–µ—Ä_–∫–æ–Ω–µ—Ü

// –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ —Å–æ–∫–µ—Ç
public async Task SendMessageAsync(NetworkStream stream, object data)
{
    byte[] packet = storage.EncryptNetworkData(data);
    await stream.WriteAsync(packet, 0, packet.Length);
    
    Console.WriteLine($"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–∞–∫–µ—Ç–æ–≤: {packet.Length} –±–∞–π—Ç");
}
```

#### `DecryptNetworkData<T>(ReadOnlyMemory<byte> data, Action<T> action)`
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–µ—Ç–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª—è—è —Ü–µ–ª—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

```csharp
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–µ—Ç–µ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
public async Task ReceiveDataAsync(NetworkStream stream)
{
    var buffer = new byte[8192];
    var memoryStream = new MemoryStream();
    
    while (true)
    {
        int bytesRead = await stream.ReadAsync(buffer, 0, buffer.Length);
        if (bytesRead == 0) break;
        
        memoryStream.Write(buffer, 0, bytesRead);
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ª–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        var remaining = storage.DecryptNetworkData<ChatMessage>(memoryStream.ToArray(), message =>
        {
            Console.WriteLine($"[{message.Sender}]: {message.Text}");
            ProcessMessage(message);
        });
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–µ–ø–æ–ª–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–∞–∫–µ—Ç–∞
		
		memoryStream.SetLength(0);
        if (remaining.Length > 0)
			memoryStream.Write(remaining.ToArray(), 0, remaining.Length);
    }
}
```

# üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π

## üéØ –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### üìä –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DataLogLevel)

```csharp
// –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
public enum DataLogLevel
{
    Error = 0,     // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
    Warning = 1,   // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
    Info = 2,      // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    Debug = 3,     // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    Trace = 4      // –î–µ—Ç–∞–ª—å–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π
public void ConfigureLogging(DataLogLevel minLevel)
{
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—é
    storage.Log += (logEvent) => 
    {
        if (logEvent.Level <= minLevel)
        {
            Console.WriteLine($"[{logEvent.Level}] {logEvent.Message}");
        }
    };
}
```

### üîî –°–æ–±—ã—Ç–∏–µ Log

#### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```csharp
// –ë–∞–∑–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
var storage = new PlayerData("–º–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á");
storage.Log += OnLogEvent;

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π
private void OnLogEvent(PlayerDataLogEvent logEvent)
{
    Console.WriteLine($"[{logEvent.Timestamp:HH:mm:ss}] {logEvent.Level}: {logEvent.Message}");
    
    if (logEvent.Exception != null)
    {
        Console.WriteLine($"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {logEvent.Exception.Message}");
        Console.WriteLine($"–°—Ç–µ–∫: {logEvent.Exception.StackTrace}");
    }
}

// –ù–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
storage.Log += LogToConsole;
storage.Log += LogToFile;

// –û—Ç–ø–∏—Å–∫–∞ –æ—Ç —Å–æ–±—ã—Ç–∏—è
storage.Log -= LogToConsole;
```